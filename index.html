<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>複数サイコロの管理</title>
    <style>
        body { font-family: sans-serif; margin: 20px; display: flex; flex-wrap: wrap; gap: 20px; }
        .dice-container {
            border: 2px solid #666;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
            width: 280px;
        }
        .dice-container h2 { margin-top: 0; font-size: 1.2em; color: #333; }
        .dice-info p { margin: 6px 0; font-size: 1em; }
        .dice-info span { font-weight: bold; }
        .face-label { display: inline-block; width: 70px; color: #555; }
        .intuitive-state { font-size: 1.4em; color: #d35400; margin-bottom: 10px !important; }
        .face-value {
            display: inline-block;
            width: 20px; /* シンボル表示幅 */
            text-align: center;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .controls button {
            padding: 8px 12px; margin: 5px 3px 0 0; font-size: 0.9em; cursor: pointer;
            background-color: #5cb85c; color: white; border: none; border-radius: 4px;
        }
        .controls button:hover { background-color: #4cae4c; }
    </style>
</head>
<body>
    <h1>複数サイコロの管理</h1>
    <div id="dices-area">
        <!-- サイコロのコンテナはJSで生成 -->
    </div>

    <script src="dice_class.js"></script>
// dice_instances.html (script タグ内の configs の修正)
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dicesArea = document.getElementById('dices-area');
            const allDiceInstances = [];

            const configs = [
                {
                    id: 'dice1',
                    initialState: { topFaceNumber: 1, orientationCode: 0 }, // 0: 奥(↑)
                    faceSymbols: { 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 6: '6' },
                    faceColors: { 1: 'red', 2: 'white', 3: 'red', 4: 'white', 5: 'red', 6: 'white' },
                    charOrientationTargetFaceNumber: { 1: 5, 5: 3, 3: 6, 6: 2, 2: 4, 4: 1 }
                },
                {
                    id: 'dice2',
                    initialState: { topFaceNumber: 1, orientationCode: 2 }, // 2: 手前(↓)
                    faceSymbols: { 1: 'A', 2: 'B', 3: 'C', 4: 'D', 5: 'E', 6: 'F' },
                    faceColors: { 1: 'white', 2: 'white', 3: 'white', 4: 'white', 5: 'white', 6: 'white' },
                    charOrientationTargetFaceNumber: { 1: 2, 2: 3, 3: 4, 4: 5, 5: 6, 6: 1 }
                },
                {
                    id: 'dice3-same-symbols',
                    initialState: { topFaceNumber: 1, orientationCode: 0 }, // 0: 奥(↑)
                    faceSymbols: { 1: 'X', 2: 'Y', 3: 'X', 4: 'Y', 5: 'X', 6: 'Y' },
                    faceColors: { 1: 'red', 2: 'white', 3: 'red', 4: 'white', 5: 'red', 6: 'white'},
                    charOrientationTargetFaceNumber: {
                        1: 2, 3: 4, 5: 6,
                        2: 1, 4: 3, 6: 5
                    }
                },
                { // 同じシンボルXを持つ面3を初期上面にしたい場合
                    id: 'dice4-same-symbols-alt-initial',
                    initialState: { topFaceNumber: 3, orientationCode: 1 }, // 1: 右(→)
                    faceSymbols: { 1: 'X', 2: 'Y', 3: 'X', 4: 'Y', 5: 'X', 6: 'Y' }, // dice3と同じシンボル
                    faceColors: { 1: 'red', 2: 'white', 3: 'red', 4: 'white', 5: 'red', 6: 'white'},
                    charOrientationTargetFaceNumber: { // dice3と同じ向きルール
                        1: 2, 3: 4, 5: 6,
                        2: 1, 4: 3, 6: 5
                    }
                }
                // ... 他のサイコロ設定 ...
            ];
            
            // configsの配列を8個に増やすロジック
            let baseConfigIndex = 0;
            while(configs.length < 8 && configs.length > 0) {
                const baseConfig = configs[baseConfigIndex % configs.length];
                const newIdNumber = configs.length + 1;
                
                let newInitialState = { topFaceNumber: 1, orientationCode: 0 }; // デフォルト
                if (baseConfig.initialState) {
                    newInitialState = { ...baseConfig.initialState };
                }

                configs.push({
                    id: `dice${newIdNumber}`,
                    initialState: newInitialState, // 変更
                    faceSymbols: { ...baseConfig.faceSymbols },
                    faceColors: { ...baseConfig.faceColors },
                    charOrientationTargetFaceNumber: { ...baseConfig.charOrientationTargetFaceNumber }
                });
                baseConfigIndex++;
            }


            configs.forEach(cfg => {
                const diceContainer = document.createElement('div');
                diceContainer.className = 'dice-container';
                diceContainer.id = `container-${cfg.id}`;
                
                diceContainer.innerHTML = `
                    <h2>サイコロ ${cfg.id.replace('dice','')}</h2>
                    <div class="dice-info">
                        <p class="intuitive-state" id="intuitive-${cfg.id}"></p>
                        <p><span class="face-label">上面:</span> <span class="face-value" id="top-${cfg.id}"></span></p>
                        <p><span class="face-label">手前面:</span> <span class="face-value" id="front-${cfg.id}"></span></p>
                        <p><span class="face-label">右面:</span> <span class="face-value" id="right-${cfg.id}"></span></p>
                        <p><span class="face-label">左面:</span> <span class="face-value" id="left-${cfg.id}"></span></p>
                        <p><span class="face-label">奥面:</span> <span class="face-value" id="back-${cfg.id}"></span></p>
                        <p><span class="face-label">底面:</span> <span class="face-value" id="bottom-${cfg.id}"></span></p>
                    </div>
                    <div class="controls">
                        <button data-dice-id="${cfg.id}" data-roll-direction="forward">奥へ</button>
                        <button data-dice-id="${cfg.id}" data-roll-direction="backward">手前へ</button>
                        <button data-dice-id="${cfg.id}" data-roll-direction="left">左へ</button>
                        <button data-dice-id="${cfg.id}" data-roll-direction="right">右へ</button>
                    </div>
                `;
                dicesArea.appendChild(diceContainer);

                try {
                    const diceInstance = new Dice(cfg.id, cfg.initialState, { // cfg.initialState を渡す
                        faceSymbols: cfg.faceSymbols,
                        faceColors: cfg.faceColors,
                        charOrientationTargetFaceNumber: cfg.charOrientationTargetFaceNumber
                    });

                    diceInstance.linkDisplayElements({
                        intuitiveState: document.getElementById(`intuitive-${cfg.id}`),
                        faceTop: document.getElementById(`top-${cfg.id}`),
                        faceFront: document.getElementById(`front-${cfg.id}`),
                        faceRight: document.getElementById(`right-${cfg.id}`),
                        faceLeft: document.getElementById(`left-${cfg.id}`),
                        faceBack: document.getElementById(`back-${cfg.id}`),
                        faceBottom: document.getElementById(`bottom-${cfg.id}`)
                    });
                    allDiceInstances.push(diceInstance);
                } catch (e) {
                    console.error(`Failed to initialize ${cfg.id}:`, e);
                    const errorMsgP = document.createElement('p');
                    errorMsgP.textContent = `Error initializing ${cfg.id}: ${e.message}`;
                    errorMsgP.style.color = 'red';
                    if (diceContainer.querySelector('.dice-info')) { // .dice-infoがあればその中に追加
                        diceContainer.querySelector('.dice-info').appendChild(errorMsgP);
                    } else {
                        diceContainer.appendChild(errorMsgP);
                    }
                }
            });

            dicesArea.addEventListener('click', (event) => {
                if (event.target.tagName === 'BUTTON' && event.target.dataset.diceId) {
                    const diceId = event.target.dataset.diceId;
                    const direction = event.target.dataset.rollDirection;
                    const dice = allDiceInstances.find(d => d.id === diceId);
                    if (dice) {
                        dice.roll(direction);
                    }
                }
            });
        });
    </script>
</body>
</html>